<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Saga Design Pattern: Choreography and Orchestration - Ugur's Personal Documentation</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content="Learn about the Saga design pattern and how it helps manage long-running transactions in microservice architecture, including Choreography and Orchestration approaches."><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Ugur's Personal Documentation" rel=home><div class="logo__item logo__text"><div class=logo__title>Ugur's Personal Documentation</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/categories/personal><span class=menu__text>Personal</span></a></li><li class=menu__item><a class=menu__link href=/categories/technical><span class=menu__text>Technical</span></a></li><li class=menu__item><a class=menu__link href=https://photos.ugurelveren.com><i class="fa fa-heart"></i>
<span class=menu__text>Photos</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Saga Design Pattern: Choreography and Orchestration</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0a14 14 0 110 28 1 1 0 010-28m0 3a3 3 0 100 22 3 3 0 000-22m1 4h-2v8.4l6.8 4.4L22 18l-6-3.8z"/></svg><time class=meta__text datetime=2024-06-18T00:00:00Z>June 18, 2024</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=/categories/technical/ rel=category>Technical</a>, <a class=meta__link href=/categories/cloud-design-patterns/ rel=category>Cloud Design Patterns</a></span></div></div></header><div class="content post__content clearfix"><p>In this article, I will discuss the Saga design pattern. First, we&rsquo;ll address some technical challenges of creating ACID transactions. Then, we&rsquo;ll explore the Saga design pattern and how to implement it.</p><h2 id=database-per-service-pattern>Database Per Service Pattern</h2><p>First, let&rsquo;s talk about microservice architecture and the database per service pattern. Basically, each microservice in an application has its own dedicated database. This allows each microservice to manage its data independently, making it easier to develop, deploy, and scale each service without affecting the others. For instance, in an online store, the user service, order service, and inventory service each have their own databases. This isolation improves flexibility, as each service can choose the best database type for its needs and makes the system more resilient to failures.</p><p>However, there are some drawbacks to this pattern. Data consistency and distributed transactions are two of them. Since each microservice operates independently, it can lead to potential inconsistencies when updates occur across multiple services. Data duplication across the system can also lead to synchronization issues. Each transaction needs to be distributed across the system. If a failure occurs, rollbacks must happen across the system, leading to another problem: distributed transactions.</p><h2 id=what-is-the-saga-design-pattern>What is the Saga Design Pattern?</h2><p>The Saga design pattern is a method for managing long-running transactions in a microservice architecture by breaking down a complex transaction into a series of smaller, independent steps, each handled by a different service. If any step fails, compensating transactions are executed to undo the changes made by previous steps, ensuring data consistency across all services. This pattern can be implemented through choreography, where each service triggers the next step via events, or orchestration, where a central coordinator directs each step. First let’s talk about Choreography.</p><h2 id=what-is-saga-choreography-pattern>What is Saga Choreography Pattern?</h2><p>Let me share the meaning of Choreography first.</p><p>Choreography refers to the art of designing and arranging dance movements and sequences. It involves creating and planning the steps, patterns, and flow of a dance performance. Choreographers are responsible for envisioning the overall structure, style, and execution of the dance, ensuring it aligns with the music, theme, and intended emotions of the performance.</p><p>Basically, for Choreography, each choreographer is responsible for the execution of the dance. It is the same for microservice structure as well. Each service is responsible for the execution of its events. If there is a problem with the execution, each service is responsible for the rollback. There is no orchestration for these executions, so it is easier to manage. Let&rsquo;s create a flow for that and make sure we are on the same page.</p><p><img src=/img/saga-choreography.png alt="Saga Choreography Mermaid Flow">
<a href=https://gist.github.com/ugurelveren/7a9327154653b91160fd3a80b200e957>Saga Choreography Mermaid Flow</a></p><h2 id=pros-of-saga-choreography>Pros of Saga Choreography</h2><ul><li><strong>Decentralization</strong>: Each service is responsible for its own. So we don’t need to worry about dependent services. Reduces coupling between services, allowing for more independent development and deployment.</li><li><strong>Scalability</strong>: Since each service operates independently, it can be scaled individually based on its load and requirements, avoiding scalability bottlenecks.</li><li><strong>Resilience</strong>: Failures in one service can be managed and compensated locally without affecting the entire system. Improved fault isolation, as issues are contained within individual services.</li><li><strong>Flexibility</strong>: Easier to add or modify services without needing to change a central orchestrator. Allows for more flexible and dynamic workflows.</li><li><strong>Autonomy</strong>: Services can choose their own way to handle business logic and compensation actions. Encourages autonomous teams responsible for individual services.</li></ul><h2 id=cons-of-saga-choreography>Cons of Saga Choreography</h2><ul><li><strong>Complexity</strong>: Since this is a distributed solution, it requires careful design, also increasing complexity in managing and understanding the entire workflow.</li><li><strong>Coordination</strong>: Harder to visualize and manage the flow of the overall business process since it is distributed. Debugging and tracing issues across multiple services can be challenging.</li><li><strong>Consistency</strong>: Maintaining eventual consistency can be tricky, especially in highly dynamic and interdependent workflows. Ensuring that all services eventually reach a consistent state requires robust compensating mechanisms.</li></ul><p>There are also challenges at the performance level, as all async solutions come with natural latency. However, there are other techniques to solve this problem. Orchestration.</p><h2 id=saga-orchestration-pattern>Saga Orchestration Pattern</h2><p>The Saga Orchestration Pattern manages long-running transactions in distributed systems by using a central orchestrator to ensure all operations either complete successfully or are rolled back through compensating actions.</p><p>There are three main steps for this:</p><ol><li><strong>Orchestrator</strong>: A central orchestrator (or coordinator) manages the entire process. It sends commands to various services to perform their tasks and waits for responses.</li><li><strong>Steps</strong>: Each step in the process is a transaction performed by a service. If the step completes successfully, the orchestrator moves to the next step.</li><li><strong>Compensation</strong>: If any step fails, the orchestrator triggers compensating transactions to undo the previous steps, ensuring data consistency.</li></ol><p>Since there are some differences between Orchestration and Choreography. Orchestration centralizes control with a coordinator managing and sequencing the workflow steps, while choreography decentralizes control, allowing each service to independently react to and trigger events as part of the saga.</p><p><img src=/img/saga-orchestration.png alt="Saga Orchestration Mermaid Flow">
<a href=https://gist.github.com/ugurelveren/b3956b856970da9492c8bf1542914dee>Saga Orchestration Mermaid Flow</a></p><h2 id=pros-of-saga-orchestration>Pros of Saga Orchestration</h2><ul><li><strong>Centralized Control</strong>: A central orchestrator manages the workflow, sending commands to and receiving responses from services.</li><li><strong>Single Point of Coordination</strong>: The orchestrator knows the sequence of steps and handles the execution and error handling.</li><li><strong>Explicit Workflow</strong>: The entire transaction flow is explicitly defined and controlled by the orchestrator.</li><li><strong>Simplicity in Implementation</strong>: Easier to implement as the orchestrator handles all the coordination.</li></ul><h2 id=cons-of-saga-orchestration>Cons of Saga Orchestration</h2><ul><li><strong>Single Point of Failure</strong>: The orchestrator can become a single point of failure, impacting the entire system if it goes down.</li><li><strong>Complexity</strong>: Adds complexity to the system architecture, especially in designing and maintaining the orchestrator.</li><li><strong>Coupling</strong>: Creates a degree of coupling between the orchestrator and the individual services, which can make changes more difficult.</li></ul><h2 id=which-saga-pattern-should-we-use>Which Saga Pattern Should We Use?</h2><p>This is the question we need to answer based on the technical requirements and complexity of our solution.</p><h3 id=saga-choreography-pattern>Saga Choreography Pattern</h3><p>Use this pattern if:</p><ul><li>You want decentralization and to avoid a single point of failure.</li><li>Transactions are relatively straightforward and services have well-defined boundaries.</li><li>You want to build a system that can scale independently without a centralized bottleneck.</li></ul><h3 id=saga-orchestration-pattern-1>Saga Orchestration Pattern</h3><p>Use this pattern if:</p><ul><li>You have complex transactions involving intricate business logic.</li><li>Steps need to be executed in a specific order.</li><li>You need strong consistency and a central entity to ensure all steps are completed correctly.</li></ul></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M4 0h8s2 0 4 2l15 15s2 2 0 4L21 31s-2 2-4 0L2 16s-2-2-2-4V3s0-3 4-3m3 10a3 3 0 000-6 3 3 0 000 6"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/saga-design-pattern/ rel=tag>saga design pattern</a></li><li class=tags__item><a class="tags__link btn" href=/tags/cloud-design-patterns/ rel=tag>cloud design patterns</a></li><li class=tags__item><a class="tags__link btn" href=/tags/cloud/ rel=tag>cloud</a></li></ul></div></footer></article></main></div><aside class=sidebar><div class="widget-search widget"><form class=widget-search__form role=search method=get action=https://duckduckgo.com/><input class=widget-search__field type=search placeholder=Search… name=q aria-label=Search…>
<input class=widget-search__submit type=submit value=Search>
<input type=hidden name=sites value=https://blog.ugurelveren.com/></form></div><div class="widget-recent widget"><h4 class=widget__title>Recent Posts</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=/post/identifying-and-fixing-monitoring-smells-for-reliable-systems/>Spotting and Fixing Monitoring Smells: A Guide to Reliable Systems</a></li><li class=widget__item><a class=widget__link href=/post/i-have-done-something/>I Moved My Blog to GitHub Again</a></li><li class=widget__item><a class=widget__link href=/post/saga-design-pattern/>Saga Design Pattern: Choreography and Orchestration</a></li><li class=widget__item><a class=widget__link href=/post/dependency-injection/>Dependency Injection</a></li><li class=widget__item><a class=widget__link href=/post/understanding-net-dependency-injection-lifetimes/>Understanding .NET Dependency Injection Lifetimes</a></li><li class=widget__item><a class=widget__link href=/post/ingredient-awareness/>A Casual Exploration of Ingredient Awareness and Global Food Regulations</a></li><li class=widget__item><a class=widget__link href=/post/circuit-breaker-pattern/>Cloud Design Patterns: Circuit Breaker Pattern</a></li><li class=widget__item><a class=widget__link href=/post/cloud-design-patterns/>Cloud Design Patterns</a></li><li class=widget__item><a class=widget__link href=/post/battling-mosquitoes/>Battling Mosquitoes: A Personal Journey</a></li><li class=widget__item><a class=widget__link href=/post/goodbye-hashnode-welcome-writefreely/>Goodbye HashNode, Welcome Writefreely</a></li></ul></div></div><div class="widget-categories widget"><h4 class=widget__title>Categories</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=/categories/algorithm/>Algorithm</a></li><li class=widget__item><a class=widget__link href=/categories/cloud/>Cloud</a></li><li class=widget__item><a class=widget__link href=/categories/cloud-design-patterns/>Cloud Design Patterns</a></li><li class=widget__item><a class=widget__link href=/categories/devops/>DevOps</a></li><li class=widget__item><a class=widget__link href=/categories/linux/>Linux</a></li><li class=widget__item><a class=widget__link href=/categories/personal/>Personal</a></li><li class=widget__item><a class=widget__link href=/categories/sre/>SRE</a></li><li class=widget__item><a class=widget__link href=/categories/technical/>Technical</a></li></ul></div></div><div class="widget-taglist widget"><h4 class=widget__title>Tags</h4><div class=widget__content><a class="widget-taglist__link widget__link btn" href=/tags/.net/ title=.Net>.Net</a>
<a class="widget-taglist__link widget__link btn" href=/tags/algorithm/ title=Algorithm>Algorithm</a>
<a class="widget-taglist__link widget__link btn" href=/tags/arrays/ title=Arrays>Arrays</a>
<a class="widget-taglist__link widget__link btn" href=/tags/azure-functions/ title="Azure Functions">Azure Functions</a>
<a class="widget-taglist__link widget__link btn" href=/tags/background-services/ title="Background Services">Background Services</a>
<a class="widget-taglist__link widget__link btn" href=/tags/blog/ title=Blog>Blog</a>
<a class="widget-taglist__link widget__link btn" href=/tags/circuit-breaker-pattern/ title="Circuit Breaker Pattern">Circuit Breaker Pattern</a>
<a class="widget-taglist__link widget__link btn" href=/tags/cloud/ title=Cloud>Cloud</a>
<a class="widget-taglist__link widget__link btn" href=/tags/cloud-architecture/ title="Cloud Architecture">Cloud Architecture</a>
<a class="widget-taglist__link widget__link btn" href=/tags/cloud-design-patterns/ title="Cloud Design Patterns">Cloud Design Patterns</a>
<a class="widget-taglist__link widget__link btn" href=/tags/dependency-injection/ title="Dependency Injection">Dependency Injection</a>
<a class="widget-taglist__link widget__link btn" href=/tags/devops/ title=DevOps>DevOps</a>
<a class="widget-taglist__link widget__link btn" href=/tags/fan-control/ title="Fan Control">Fan Control</a>
<a class="widget-taglist__link widget__link btn" href=/tags/food/ title=Food>Food</a>
<a class="widget-taglist__link widget__link btn" href=/tags/food-regulations/ title="Food Regulations">Food Regulations</a>
<a class="widget-taglist__link widget__link btn" href=/tags/github/ title=GitHub>GitHub</a>
<a class="widget-taglist__link widget__link btn" href=/tags/hashnode/ title=Hashnode>Hashnode</a>
<a class="widget-taglist__link widget__link btn" href=/tags/linux/ title=Linux>Linux</a>
<a class="widget-taglist__link widget__link btn" href=/tags/markdown/ title=Markdown>Markdown</a>
<a class="widget-taglist__link widget__link btn" href=/tags/monitoring/ title=Monitoring>Monitoring</a>
<a class="widget-taglist__link widget__link btn" href=/tags/monitoring-smells/ title="Monitoring Smells">Monitoring Smells</a>
<a class="widget-taglist__link widget__link btn" href=/tags/mosquitoes/ title=Mosquitoes>Mosquitoes</a>
<a class="widget-taglist__link widget__link btn" href=/tags/observability/ title=Observability>Observability</a>
<a class="widget-taglist__link widget__link btn" href=/tags/personal-journey/ title="Personal Journey">Personal Journey</a>
<a class="widget-taglist__link widget__link btn" href=/tags/prefix-sum/ title="Prefix Sum">Prefix Sum</a>
<a class="widget-taglist__link widget__link btn" href=/tags/python/ title=Python>Python</a>
<a class="widget-taglist__link widget__link btn" href=/tags/raspberry-pi/ title="Raspberry Pi">Raspberry Pi</a>
<a class="widget-taglist__link widget__link btn" href=/tags/saga-design-pattern/ title="Saga Design Pattern">Saga Design Pattern</a>
<a class="widget-taglist__link widget__link btn" href=/tags/serverless/ title=Serverless>Serverless</a>
<a class="widget-taglist__link widget__link btn" href=/tags/sliding-window/ title="Sliding Window">Sliding Window</a>
<a class="widget-taglist__link widget__link btn" href=/tags/sre/ title=SRE>SRE</a>
<a class="widget-taglist__link widget__link btn" href=/tags/static-website/ title="Static Website">Static Website</a>
<a class="widget-taglist__link widget__link btn" href=/tags/systemd/ title=Systemd>Systemd</a>
<a class="widget-taglist__link widget__link btn" href=/tags/two-pointer/ title="Two Pointer">Two Pointer</a>
<a class="widget-taglist__link widget__link btn" href=/tags/writefreely/ title=Writefreely>Writefreely</a></div></div><div class="widget-social widget"><h4 class="widget-social__title widget__title">Social</h4><div class="widget-social__content widget__content"><div class="widget-social__item widget__item"><a class="widget-social__link widget__link btn" title="My Home Page" rel=me href=https://ugurelveren.com target=_blank><span>My Home Page</span></a></div></div></div></aside></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2024 Ugur's Personal Documentation.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>